language: java
jdk:
    - openjdk6
env:
    global:
        # From http://stackoverflow.com/a/21841688
        - TERM=dumb
        # Deployment target for oxcross
        - MACOSX_DEPLOYMENT_TARGET=10.9
        - artifactory_user=jfly
        # Setting the artifactory_password env var
        - secure: "bsAUSuyK5j7CvTtuGhYZlvg3KIz7vQKtPVae7hkYfRbWUJRUs+XO/1KEYqZajVsBNTHItN6uTr64t5MF9PExYA0smJLtYzBGjrejlB1Z7V14d7+1mvqE1luI9OtrEG713v9UTGN4Pa5OXpHBvpJTcsT/ep6IkfkXcLVUF64JOwY="

before_install:
    # From http://stackoverflow.com/a/11069162
    - sudo apt-get update
    - sudo apt-get install aptitude

    # To compile 32-bit Linux binaries even though we're on 64 bit.
    - sudo aptitude install -y libc6-dev-i386 lib32stdc++6 gcc-multilib g++-multilib

    # To compile 32-bit and 64-bit Windows binaries.
    - sudo aptitude install -y g++-mingw-w64

    # To compile for OS X, we need osxcross.
    - git clone --depth=1 https://github.com/tpoechtrager/osxcross
    - cd osxcross
    - (cd tarballs; wget https://dl.dropboxusercontent.com/u/1463845/osxcross/MacOSX10.9.sdk.tar.bz2)
    - sudo tools/get_dependencies.sh
    - yes | ./build.sh
    - eval `target/bin/osxcross-env`
    - cd ..

    # Install swig so we can run tests
    - sudo apt-get -qq install swig python3-dev

install:
    # Disable default "./gradlew assemble" command.
    # See http://stackoverflow.com/a/23416671
    - true

script:
    # Build and publish to oss.jfrog.org
    - ./gradlew artifactoryPublish
